<Page
    x:Class="MyShop.App.Views.ImportProductsScreen"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    x:Name="PageRoot"
    Background="#F5F7FA">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel>
                <TextBlock Text="Import Products from Excel" 
                          FontSize="30" 
                          FontWeight="Bold"
                          Foreground="#0F3D5E"/>
                <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" 
                          FontSize="14" 
                          Foreground="#6B7280"
                          Margin="0,4,0,0"/>
            </StackPanel>

            <Button Grid.Column="1" 
                    Content="âœ• Close" 
                    Background="#EF4444" 
                    Foreground="White"
                    Click="OnCloseClick"
                    Padding="16,8"/>
        </Grid>

        <!-- Summary Stats -->
        <Grid Grid.Row="1" Margin="0,0,0,16" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Background="#F3F4F6" CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="Total Rows" FontSize="12" Foreground="#6B7280"/>
                    <TextBlock Text="{x:Bind ViewModel.TotalRows, Mode=OneWay}" FontSize="32" FontWeight="Bold" Foreground="#111827"/>
                </StackPanel>
            </Border>

            <Border Grid.Column="1" Background="#ECFDF5" CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="Valid" FontSize="12" Foreground="#059669"/>
                    <TextBlock Text="{x:Bind ViewModel.ValidRows, Mode=OneWay}" FontSize="32" FontWeight="Bold" Foreground="#059669"/>
                </StackPanel>
            </Border>

            <Border Grid.Column="2" Background="#FEF2F2" CornerRadius="8" Padding="16">
                <StackPanel>
                    <TextBlock Text="Invalid" FontSize="12" Foreground="#DC2626"/>
                    <TextBlock Text="{x:Bind ViewModel.InvalidRows, Mode=OneWay}" FontSize="32" FontWeight="Bold" Foreground="#DC2626"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Data Grid -->
        <Border Grid.Row="2" 
                Background="White" 
                CornerRadius="8" 
                BorderBrush="#E5E7EB" 
                BorderThickness="1">
            <controls:DataGrid x:Name="ImportDataGrid"
                      ItemsSource="{x:Bind ViewModel.ImportRows, Mode=OneWay}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      GridLinesVisibility="All"
                      HeadersVisibility="Column"
                      CanUserSortColumns="True"
                      CanUserResizeColumns="True"
                      ColumnHeaderHeight="40"
                      AlternatingRowBackground="#F9FAFB">
                
                <controls:DataGrid.Columns>
                    <controls:DataGridTextColumn Header="" Binding="{Binding RowNumber}" Width="40"/>
                    <controls:DataGridTextColumn Header="Status" Binding="{Binding ValidationStatus}" Width="95"/>
                    <controls:DataGridTemplateColumn Header="Img" Width="70">
                        <controls:DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Width="40" Height="40" Margin="4" CornerRadius="4" Background="#F3F4F6">
                                    <Grid>
                                        <TextBlock Text="" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="#9CA3AF"/>
                                        <Image Source="{Binding ImageUrl}" Stretch="UniformToFill"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </controls:DataGridTemplateColumn.CellTemplate>
                    </controls:DataGridTemplateColumn>
                    <controls:DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="160"/>
                    <controls:DataGridTextColumn Header="SKU" Binding="{Binding Sku}" Width="120"/>
                    <controls:DataGridTextColumn Header="Category" Binding="{Binding CategoryName}" Width="110"/>
                    <controls:DataGridTextColumn Header="Price" Binding="{Binding Price}" Width="75"/>
                    <controls:DataGridTextColumn Header="Stock" Binding="{Binding Stock}" Width="75"/>
                        <controls:DataGridTextColumn Header="Error Details" Binding="{Binding ErrorSummary}" Width="500"/>
                </controls:DataGrid.Columns>
            </controls:DataGrid>
        </Border>

        <!-- Progress Bar -->
        <ProgressBar Grid.Row="3" 
                     Value="{x:Bind ViewModel.ImportProgress, Mode=OneWay}"
                     Maximum="100"
                     Visibility="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                     Margin="0,16,0,8"
                     Height="4"/>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    Spacing="12"
                    Margin="0,16,0,0">
            <Button Content="Cancel" 
                    Background="#6B7280" 
                    Foreground="White"
                    Padding="24,10"
                    Click="OnCloseClick"/>
            <Button Content="Import Valid Rows" 
                    Background="#0F3D5E" 
                    Foreground="White"
                    Padding="24,10"
                    Command="{x:Bind ViewModel.ImportValidRowsCommand}"
                    IsEnabled="{x:Bind ViewModel.HasValidRows, Mode=OneWay}"/>
        </StackPanel>
    </Grid>
</Page>
