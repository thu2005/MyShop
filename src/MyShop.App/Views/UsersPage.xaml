<Page
    x:Class="MyShop.App.Views.UsersPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:MyShop.Core.Models"
    xmlns:converters="using:MyShop.App.Converters"
    mc:Ignorable="d"
    Background="#F5F7FA">

    <Page.Resources>
        <converters:DateFormatConverter x:Key="DateFormatConverter"/>
    </Page.Resources>

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- List -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel>
                <TextBlock Text="Staff Management" FontSize="30" FontWeight="Bold" Foreground="#0C2B4E"/>
                <TextBlock Text="Home > Staff Management" FontSize="14" Foreground="{ThemeResource TextFillColorSecondaryBrush}" Margin="0,4,0,0"/>
            </StackPanel>

            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="16">
                <AutoSuggestBox x:Name="StaffSearchBox" 
                                Width="300" 
                                PlaceholderText="Search staff by username..." 
                                QueryIcon="Find"
                                TextChanged="StaffSearchBox_TextChanged"
                                QuerySubmitted="StaffSearchBox_QuerySubmitted"
                                VerticalAlignment="Center"
                                CornerRadius="4"/>
                
                <Button Background="#003F62" Foreground="White" Padding="16,8" CornerRadius="4" Click="AddStaff_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <SymbolIcon Symbol="AddFriend"/>
                        <TextBlock Text="ADD NEW STAFF"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>

        <!-- List Container -->
        <Grid Grid.Row="1" Background="White" CornerRadius="8" Padding="0" BorderBrush="#E0E0E0" BorderThickness="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Title/Actions -->
                <RowDefinition Height="Auto"/> <!-- Header -->
                <RowDefinition Height="*"/>    <!-- Items -->
            </Grid.RowDefinitions>

            <TextBlock Text="Staff Directory" FontSize="18" FontWeight="SemiBold" Margin="24,12"/>

            <!-- Progress Ring for loading -->
            <ProgressRing IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}" 
                          HorizontalAlignment="Center" VerticalAlignment="Center" 
                          Grid.RowSpan="3" Canvas.ZIndex="1"/>

            <!-- Table Header -->
            <Grid Grid.Row="1" Background="#F9FAFB" Padding="24,12" BorderBrush="#E0E0E0" BorderThickness="0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*"/> <!-- ID -->
                    <ColumnDefinition Width="2*"/> <!-- Username -->
                    <ColumnDefinition Width="2*"/> <!-- Email -->
                    <ColumnDefinition Width="1.5*"/> <!-- Role -->
                    <ColumnDefinition Width="1.5*"/> <!-- Status -->
                    <ColumnDefinition Width="2*"/> <!-- Created At -->
                    <ColumnDefinition Width="1*"/> <!-- Actions -->
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="ID" FontWeight="SemiBold" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="1" Text="Username" FontWeight="SemiBold" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="2" Text="Email" FontWeight="SemiBold" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="3" Text="Role" FontWeight="SemiBold" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="4" Text="Status" FontWeight="SemiBold" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="5" Text="Joined Date" FontWeight="SemiBold" Foreground="#666666" VerticalAlignment="Center"/>
                <TextBlock Grid.Column="6" Text="Action" FontWeight="SemiBold" Foreground="#666666" HorizontalAlignment="Center" VerticalAlignment="Center"/>
            </Grid>

            <!-- Items -->
            <ListView Grid.Row="2" ItemsSource="{x:Bind ViewModel.Users, Mode=OneWay}" SelectionMode="None">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="0"/>
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:User">
                        <Grid Padding="24,16" BorderBrush="#F0F0F0" BorderThickness="0,0,0,1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="1.5*"/>
                                <ColumnDefinition Width="1.5*"/>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="1*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Text="{x:Bind Id}" VerticalAlignment="Center" Foreground="#888888"/>
                            
                            <TextBlock Grid.Column="1" Text="{x:Bind Username}" VerticalAlignment="Center" FontWeight="Medium"/>
                            
                            <TextBlock Grid.Column="2" Text="{x:Bind Email}" VerticalAlignment="Center"/>
                            
                            <TextBlock Grid.Column="3" Text="{x:Bind Role}" VerticalAlignment="Center"/>

                            <StackPanel Grid.Column="4" Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <Ellipse Width="8" Height="8" Fill="{x:Bind IsActive, Converter={StaticResource StatusToColorConverter}}"/>
                                <TextBlock Text="{x:Bind IsActive, Converter={StaticResource StatusLabelConverter}}" FontSize="12"/>
                            </StackPanel>

                            <TextBlock Grid.Column="5" Text="{x:Bind CreatedAt, Converter={StaticResource DateFormatConverter}}" VerticalAlignment="Center"/>

                            <Button Grid.Column="6" Background="Transparent" BorderThickness="0" HorizontalAlignment="Center">
                                <SymbolIcon Symbol="More"/>
                                <Button.Flyout>
                                    <MenuFlyout>
                                        <MenuFlyoutItem Text="Edit" Icon="Edit" Click="EditUser_Click" Tag="{Binding}"/>
                                        <MenuFlyoutItem Text="Delete" Icon="Delete" Click="DeleteUser_Click" Tag="{Binding}"/>
                                    </MenuFlyout>
                                </Button.Flyout>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Page>
